# 数学建模初步思路

# 概述（目标）

设计无人机飞行方向、飞行速度、每枚烟幕干扰弹的投放点（释放时刻）和起爆点（或引信时序），使得在来袭导弹到达假目标前，通过烟幕形成的遮蔽尽量**延长**来袭导弹对真目标的“有效遮蔽时间”。

* 遮蔽判定采用几何判定：当且仅当“烟幕球体”与“从导弹到真目标的视线段”相交（即烟幕位于两者之间）时，视线被遮蔽。
* 目标函数：最大化各来袭导弹被遮蔽的总时长（或加权和）。
* 要求：参数具有可解释性（航向角、速度、投放/起爆坐标或时刻、引信延时等均解释明确），满足题目约束（速度范围、投放间隔、每机负载限制等）。

# 符号表（论文中直接引用）

已知常量：

* 假目标原点： $O=(0,0,0)$（题设）
* 真目标圆柱： 半径 $R_T=7$ m，高 $H_T=10$ m，圆心（底面）$T=(0,200,0)$。
* 导弹 $i$ 初始位置 $M_{0,i}=(x_{Mi},y_{Mi},z_{Mi})$，等速直线飞行，速度 $V_M=300\ \mathrm{m/s}$。
* 无人机 $k$ 初始位置 $U_{0,k}=(x_{Uk},y_{Uk},z_{Uk})$（题中有 FY1..FY5）。
* 云团半径 $r=10\ \mathrm{m}$（球），云有效持续时间 $T_{\text{cloud}}=20\ \mathrm{s}$，下沉速率 $v_c=3\ \mathrm{m/s}$（竖直向下）。
* 干扰弹释放后遵循自由落体（重力 $g=9.8\ \mathrm{m/s^2}$）；释放时与无人机水平速度一致（忽略空气阻力/横向弹道复杂因素）。
* 无人机匀速直线水平飞行，速度 $v_k\in[70,140]\ \mathrm{m/s}$，航向角（水平） $\theta_k\in[0,2\pi)$，z 恒等于 $U_{0,k,z}$。

决策变量（可解释）：

* 对 UAV $k$：航向角 $\theta_k$、速度 $v_k$。
* 对每枚干扰弹 $j$（挂载在某 UAV $k(j)$）：

  * 投放时刻 $t_{\text{drop},j}$（≥0）；
  * 引信延时 $\tau_j$（≥0），起爆时刻 $t_{\text{det},j}=t_{\text{drop},j}+\tau_j$；
  * 起爆点坐标 $P_{\text{det},j}=(x_{dj},y_{dj},z_{dj})$（由物理弹道约束与 UAV 轨迹耦合）。

衍生量：

* 导弹 $i$ 单位方向 $\mathbf{u}_{M,i}=\dfrac{T-M_{0,i}}{\|T-M_{0,i}\|}$。导弹位置： $M_i(t)=M_{0,i}+V_M\mathbf{u}_{M,i}t$。命中时间： $t_{hit,i}=\dfrac{\|T-M_{0,i}\|}{V_M}$。
* UAV $k$ 单位航向向量 $\mathbf{e}_k=(\cos\theta_k,\sin\theta_k,0)$。位置： $U_k(t)=U_{0,k}+v_k\mathbf{e}_k t$。
* 干扰弹释放轨迹（释放后局部时间 $\delta\in[0,\tau]$）：

  $$
  P_{\text{bomb}}(\delta) = P_{\text{drop}} + v_k \mathbf{e}_k \delta + \tfrac12 (0,0,-g)\delta^2.
  $$

  起爆点： $P_{\text{det},j}=P_{\text{drop},j} + v_{k(j)}\mathbf{e}_{k(j)}\tau_j + \tfrac12 (0,0,-g)\tau_j^2$.
* 云团中心随绝对时间 $t\ge t_{\text{det},j}$：

  $$
  C_j(t)=P_{\text{det},j} + (0,0,-v_c(t-t_{\text{det},j})),\quad t\in[t_{\text{det},j},t_{\text{det},j}+T_{\text{cloud}}].
  $$

# 干扰（遮蔽）判定（数学形式）

在时间 $t$ 下，考虑导弹 $i$ 的线段 $L_i(t)=[M_i(t),\,T]$。若存在某枚云 $j$ 满足：

* $t\in[t_{\text{det},j},t_{\text{det},j}+T_{\text{cloud}}]$，且
* 最短距离 $d_{i,j}(t)=\operatorname{dist}(C_j(t),L_i(t)) \le r$,

则在时刻 $t$ 导弹 $i$ 对真目标的视线被遮蔽。点到线段的最短距离计算（常规）：

* 令 $A=M_i(t),\ B=T,\ v=B-A,\ w=C_j(t)-A$。
* 若 $v\cdot v=0$（导弹与目标重合），取 $d=\|C_j(t)-A\|$；否则投影参数 $s=\dfrac{w\cdot v}{v\cdot v}$, 截断 $\bar s=\operatorname{clamp}(s,0,1)$，最近点 $P_{\text{closest}}=A+\bar s v$，距离 $d=\|C_j(t)-P_{\text{closest}}\|$。

# 遮蔽时长（目标函数）

对导弹 $i$ 的遮蔽时长定义：

$$
S_i = \int_{0}^{t_{hit,i}} \mathbf{1}\Big(\exists j: t\in[t_{\text{det},j},t_{\text{det},j}+T_{\text{cloud}}]\ \wedge\ d_{i,j}(t)\le r\Big)\,dt.
$$

总体目标（示例）：最大化加权和

$$
\max\ S = \sum_{i} w_i S_i,
$$

通常取 $w_i=1$。

# 约束（完整列出）

1. 无人机速度： $70\le v_k\le 140$（m/s）。
2. 无人机水平等高度飞行： $U_k(t)_z = U_{0,k,z}$ 恒定。
3. 无人机航向与速度确定后固定，不可中途调整（题设）。
4. 每架无人机两次投放时间间隔 ≥ 1 s： 对同一 UAV $k$ 的任意两枚弹 $p,q$， $|t_{\text{drop},p}-t_{\text{drop},q}|\ge 1$。
5. 起爆点高度不能低于地面： $P_{\text{det},j,z}\ge 0$（或取更高安全高度）。
6. 投放时刻非负： $t_{\text{drop},j}\ge 0$。
7. 干扰弹起爆点必须位于对应 UAV 的飞行轨线上并满足弹道： 存在 $t_{\text{det},j}$ 使得

   $$
   P_{\text{det},j,xy} = U_{0,k,xy} + v_k \mathbf{e}_{k,xy} t_{\text{det},j},\qquad
   P_{\text{det},j,z} = U_{0,k,z} - \tfrac12 g \tau_j^2,
   $$

   且 $t_{\text{drop},j}=t_{\text{det},j}-\tau_j$.（等式组是可解释的物理解耦）
8. 每架 UAV 的弹药上限（题设 Q5：最多 3 枚）。

# 参数化与可解释决策设计（关键设计）

为保证参数可解释，同时便于约束实现与优化，采用 **“以起爆点 $P_{\text{det}}$（或其横坐标在 UAV 航线上的弧长/距离 s）为主要决策量”** 的参数化方法。步骤与原因：

* 说明：起爆点 $P_{\text{det}}$ 是空间位置（直观）；从 $P_{\text{det}}$ 可逆算出引信 $\tau$（用垂直坐标）与起爆时刻 $t_{\text{det}}$（用 UAV 水平投影），并进而得到投放时刻 $t_{\text{drop}}$。因此优化可以在 $P_{\text{det}}$、$\theta_k$、$v_k$ 空间进行，决策量直观、利于答辩。
* 具体反算关系（给定 UAV $k$、航向 $\theta_k$、速度 $v_k$ 以及起爆点 $P_{\text{det}}$）：

  * 必要条件（横向）： $P_{\text{det,xy}} - U_{0,k,xy}$ 与 $\mathbf{e}_{k,xy}$ 同向；即存在 $t_{\text{det}}\ge 0$ 使

    $$
    P_{\text{det,xy}} = U_{0,k,xy} + v_k \mathbf{e}_{k,xy} t_{\text{det}} \quad\Rightarrow\quad t_{\text{det}} = \frac{\|P_{\text{det,xy}} - U_{0,k,xy}\|}{v_k}.
    $$
  * 垂直分量反推引信： $\tau = \sqrt{\frac{2(U_{0,k,z}-P_{\text{det},z})}{g}}$（需要 $P_{\text{det},z}\le U_{0,k,z}$）。
  * 投放时刻： $t_{\text{drop}} = t_{\text{det}} - \tau$（需 ≥0；若 <0 则该 $P_{\text{det}}$ 不可行）。
* 这样可显式检查投放间隔、投放非负、速度范围等约束。

# 求解方法总览（Pipeline）

总体采用**分层 + 采样 + 优化**策略，兼顾可解释性与数值效率：

1. **候选生成层（构造可解释候选）**：

   * 对每枚导弹 $i$ 计算关键时间点（例如最近接目标时刻 $t_i^*$），在其周围生成若干候选起爆时刻 $t_{\text{det}}$（例如步长 0.5–1s，区间 $[t_i^*-T_1,t_i^*+T_2]$，T1/T2 可设 30s/5s）。
   * 对每个候选起爆时刻，确定候选云心位置（例如沿导弹—目标连线按若干位置采样；或用构造智选点：中点、目标侧偏点等）。
   * 对每个候选云心 $C$ 计算对应的 $P_{\text{det}}$（云心在起爆时就是 $P_{\text{det}}$），并对每架 UAV 检查是否存在满足速度范围和非负投放时刻的解（用上节反算）。
   * 通过此得到一个**可行候选集合**（每项包含：对应 UAV、起爆时刻、投放时刻、投放点、预测遮蔽贡献）。
2. **遮蔽贡献评估**：

   * 对每候选单元 $j$，对每导弹 $i$ 进行短时仿真（或解析判断）计算该候选单元独立造成的遮蔽时间 $c_{i,j}$（基于 LOS-球体相交和云有效时段）。候选单元的总贡献 $c_j=\sum_i w_i c_{i,j}$。
3. **选择/分配层（整数调度）**：

   * 将候选作为“任务单元”，建立 0-1 整数规划：

     $$
     \max\ \sum_j c_j x_j
     $$

     s.t.

     * 对每 UAV $k$： $\sum_{j\in\mathcal{J}_k} x_j \le N_k$（弹药上限，如 N\_k=1/3）；
     * 对每 UAV，任意两个选中的单元 $p,q$ 若释放间隔 <1s 则不允许同时选（可建冲突矩阵或用线性大 M 约束）；
     * 其它结构性约束（如每弹只选一次，时间可行性保持等）。
   * 求解可用 CP-SAT（OR-Tools）、或者 ILP 求解器、亦可使用启发式（贪心 + 局部搜索）。该步骤得到一个可行的候选组合（离散部分）。
4. **局部连续精调**：

   * 对整数层确定的组合，进行连续变量精调（微调每个选中单元的 $P_{\text{det},z}$ 或 $t_{\text{det}}$ 等）以最大化真实目标。此步可用连续优化（L-BFGS-B、SLSQP、或用自动微分的 Adam）解决。
5. **（可选）梯度化整体求解**：

   * 为了更高效地局部优化连续参数，可用“可微化遮蔽指标”替代 0/1 指示（见下节）。对整数部分可先固定（或松弛为概率分配再做投票/舍入）。
6. **验证 & 鲁棒性分析**：

   * 对最优解做蒙特卡洛扰动（引信时延±Δt、UAV 初始位置误差、云下沉速度变化）并计算期望与最坏情形，给出稳健性评价。
7. **输出**：按题目模板生成 result1.xlsx、result2.xlsx、result3.xlsx 并附可视化图（时间线、XY 投影、3D 轨迹）。

# 可微化（梯度化）处理（便于用梯度法）

遮蔽指示函数不连续，不利于梯度优化。做如下近似：

* 将 $I_{[d\le r]}$ 用 Sigmoid/logistic 平滑逼近：

$$
\sigma(d)=\frac{1}{1+\exp(\alpha(d-r))},\quad \alpha\gg1\ \text{(控制陡峭度)}.
$$

* 将“并集”用 softmax/概率逻辑近似：在时间 $t$，云 $j$ 的遮蔽强度 $s_{i,j}(t)=\sigma(d_{i,j}(t))\cdot \phi_j(t)$，其中 $\phi_j(t)$ 为云存在函数（可用 smooth window：$\phi_j(t)=\operatorname{sigmoid}(\beta(t-t_{\text{det},j}))-\operatorname{sigmoid}(\beta(t-(t_{\text{det},j}+T_{\text{cloud}})))$）。取时间点遮蔽概率近似为 $S_i(t)\approx 1-\prod_j(1-s_{i,j}(t))$（或 softmax max 近似）。再用数值积分得到平滑目标 $\tilde S$。对变量求导可用自动微分工具（PyTorch/JAX）。

用途：

* 在候选生成或连续精调阶段，用梯度法快速优化连续参数（$P_{\text{det},z}, t_{\text{det}}, v_k, \theta_k$），并在求解后用原始 0/1 判定验证结果。

# 分题求解具体流程（写进论文时每题一个 subsection）

### Q1（单机一弹，已给变量）

输入：FY1 速度 120 m/s，朝向假目标，投放延时 1.5 s，起爆延时 3.6 s。
求解流程（直接仿真）：

1. 计算 UAV 航向单元向量 $\mathbf{e}$（指向假目标）；计算释放点 $P_{\text{drop}}=U_{0,FY1}+v\mathbf{e}\cdot 1.5$。
2. 计算起爆点 $P_{\text{det}}=P_{\text{drop}}+v\mathbf{e}\cdot 3.6 + \tfrac12(0,0,-g)3.6^2$。
3. 起爆时刻 $t_{\text{det}}=1.5+3.6$；云存在区间 $[t_{\text{det}},t_{\text{det}}+20]$。
4. 对 $t\in[0,t_{hit}]$ 离散化（步长 0.01s），在云存在时刻用 LOS-球体相交判定计算覆盖布尔值，求并集时长 $S_1$。
   输出：数值 $S_1$、具体投放点与起爆点。
   （实现细节见后）

### Q2（单机一弹，优化）

目标：在允许调整 $v\in[70,140]$ 与 $\theta$ 下，选择 $P_{\text{det}}$（或等价 $t_{\text{det}}$, $\tau$）使 $S_1$ 最大。
策略（两步结合）：

* Step A：解析构造 baseline：把云在导弹最近接目标时 $t^*$ 放在导弹—目标连线的中点（或按一定比例 α），反算需要的 $P_{\text{det}}$ 与 UAV 所需速度 $v$。若 $v$ 不在范围内或 $t_{\text{drop}}<0$ 则调整 α 或 $P_{\text{det},z}$。
* Step B：以构造解为初值，使用连续优化（若使用平滑指标则可用 L-BFGS-B，目标为 $\tilde S_1$）对 $\theta,v,P_{\text{det},z},t_{\text{det}}$ 做局部精调（保持物理可行性）。
  最终输出：最优或局部最优 $ (\theta,v,P_{\text{det}},t_{\text{det}},\tau)$ 及对应 $S_1$。

### Q3（FY1 投 3 枚弹干扰 M1）

策略：构造性+优化。

* 构造：把三个起爆时刻放在 $t^* - \Delta_1$, $t^*$, $t^*+\Delta_2$（例如 $\Delta_{1,2}$ 选 10\~20s 范围），对每个按 Q2 反算 $P_{\text{det}}$ 与释放时间，检查可行性与间隔 ≥1s。
* 然后用局部搜索或连续优化微调每枚的 $t_{\text{det}},P_{\text{det},z}$ 以最大化并集遮蔽时长。
* 输出 result1.xlsx（按题目模板一行一弹，包含航向、速度、编号、投放/起爆坐标、有效时长）。

### Q4（FY1,FY2,FY3 各投1枚）

为每个 UAV 做 Q2 式单弹优化（优先考虑让近目标 UAV 负责靠近导弹到达时刻附近的覆盖），再联合考虑三弹遮蔽的并集（局部微调）。输出 result2.xlsx。

### Q5（5 架 UAV、最多 3 枚/机、干扰 M1,M2,M3）

这是调度 + 连续优化混合问题，按上文 Pipeline 执行：

1. 对每导弹采样候选 $t_{\text{det}}$ 与 $P_{\text{det}}$（沿导弹—目标线及附近若干偏移），并为每候选匹配可行 UAV（依据速度可达性、投放时刻非负）。
2. 评估每候选对三个导弹的遮蔽贡献 $c_j$。
3. 用 0-1 整数规划选择候选集合（约束：每机 ≤3枚、释放间隔≥1s、投放时刻非负）。
4. 对选中的候选做连续精调并最终输出 result3.xlsx。

# 数值实现细节（用于代码实现与复现实验）

1. **时间离散化**：遮蔽判定与积分采用步长 $\Delta t$。建议 $\Delta t = 0.01$ s（高精度）；若求速可用 0.05 s。
2. **距离判定**：点到线段最近点公式数值稳定；若线段长度极小（导弹几乎在目标处）做退化处理。
3. **边界精度**：若需更精确的遮蔽开始/结束时刻，可在步长粗网格上定位边界后用二分法求解 $d(t)=r$ 的精确根。
4. **候选数与步长**：Q5 的候选采样不要过密（避免爆炸性增长）。例如对每导弹在 $[t^*-30,t^*+5]$ 区间每 1 s 采样，沿 xy 连线每隔 20 m 采样若干点，组合后再筛选可行性，通常得到几百至上千候选，足以整数规划。
5. **整数规划实现**：Google OR-Tools CP-SAT、CBC、Gurobi 等均可；若用启发式可选差分进化/遗传/贪心+局部搜索。
6. **连续优化实现**：若使用平滑目标，用 PyTorch/JAX 做自动微分。否则用 SciPy 的 L-BFGS-B/SLSQP 做局部优化（需给出梯度或使用数值梯度）。
7. **并行化**：候选的遮蔽贡献评估可并行（每候选单元独立），建议并行化加速（multiprocessing或joblib）。

# 鲁棒性/敏感性分析（必要）

* 对关键参数做扰动试验：

  * 引信误差 ±0.5 s、±1 s；
  * UAV 速度误差 ±5%；
  * 云下沉速 ±0.5 m/s；
  * 起爆点高度误差 ±5 m。
* 计算扰动下的期望遮蔽时长与最坏-最好情形，给出稳健性结论与改良建议（例如把云起爆时间选择偏长一侧以保证更大概率在关键时刻覆盖）。

# 论文写作与答辩要点（评分落点）

1. **模型清晰**：把符号表、动力学方程、遮蔽判定（点–线段–球体距离公式）写明且逐条解释物理含义。
2. **可解释参数**：强调决策变量均为直观物理量（航向角、速度、起爆坐标、投放/引信时间），便于评委判断合理性。
3. **求解策略**：分层（候选采样 + 整数选择 + 连续精调 + 梯度化优化）既实用又具有学术价值。
4. **数值结果**：给出 baseline 构造解（可解释）与优化解对比，展示提升量（例如遮蔽时长从 0 提升到 X s）。
5. **可视化**：时间线与平面/三维图说明遮蔽的直观过程。
6. **鲁棒性**：进行扰动试验，给出结论并解释为何方案稳健或如何改进。
7. **讨论局限**：列出模型假设（忽略空气阻力、云为球体、下沉速度恒定等）并讨论可能影响与未来改进方向。


# 参数建议（数值）

* 时间步长 dt = 0.01 s（高精度）；若计算量大，可先用 0.05 s做粗筛再精化。
* 候选采样间隔： t\_det 步长 0.5–1 s（Q5 则取 1 s）；位置沿线步长 20–50 m。
* Soft approximation参数（可微化）： logistic α=10–50（越大越接近 0/1），时间窗口 sigmoid β≈10。
